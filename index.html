<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BACKSECRET - Elite Authority</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Rajdhani:wght@500;600;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        royal: ['Cinzel', 'serif'],
                        tech: ['Rajdhani', 'sans-serif'],
                        mono: ['Share Tech Mono', 'monospace'],
                    },
                    colors: {
                        bgMain: '#020202',
                        bgCard: '#070707',
                        chromeLight: '#f1f1f1',
                        chromeMid: '#9a9a9a',
                        redMain: '#ff1111',
                        redDark: '#4a0000',
                    },
                    boxShadow: {
                        'red-glow': '0 0 20px rgba(255, 17, 17, 0.4), inset 0 0 10px rgba(255, 17, 17, 0.1)',
                        'metal': 'inset 0 1px 0 rgba(255,255,255,0.1), inset 0 -1px 0 rgba(0,0,0,0.8), 0 10px 30px rgba(0,0,0,0.8)',
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style>
        /* --- 1. DESIGN LANGUAGE & DEPTH LAYER --- */
        body {
            background-color: #020202;
            color: #cfcfcf;
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            transition: filter 0.1s ease-out;
        }

        /* 1️⃣ Depth Layer Vignette */
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at center, transparent 40%, rgba(0,0,0,0.55));
            pointer-events: none;
            z-index: 10;
        }

        /* 2️⃣ Ambient Red Glow + Glass Dust Texture */
        body::after {
            content: "";
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 50% 20%, rgba(255, 17, 17, 0.06), transparent 60%),
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Ccircle cx='60' cy='60' r='1' fill='white' opacity='0.03'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
            animation: ambientPulse 12s ease-in-out infinite;
        }

        @keyframes ambientPulse {
            0%,100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* 4️⃣ LOCK ALERT SCREEN SHAKE (Localized) */
        @keyframes shake {
            0%,100% { transform: translateX(0); }
            25% { transform: translateX(1px); }
            75% { transform: translateX(-1px); }
        }

        /* Scanlines */
        .scanlines {
            position: fixed;
            inset: 0;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.3));
            background-size: 100% 3px;
            pointer-events: none;
            z-index: 40;
            opacity: 0.12;
        }

        /* Giant Watermark - Static */
        .logo-watermark {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80vw;
            max-width: 700px;
            opacity: 0.03;
            pointer-events: none;
            z-index: -1;
            filter: grayscale(100%) contrast(120%);
            will-change: transform; 
        }

        /* --- 2. HEADER EMBLEM PANEL --- */
        header {
            position: relative;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.06), 0 0 40px rgba(255,0,0,0.04);
        }
        header::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,17,17,0.03), transparent);
            pointer-events: none;
        }
        header img {
            filter:
              drop-shadow(0 0 8px rgba(255,255,255,0.08))
              drop-shadow(0 0 12px rgba(255,0,0,0.15));
            transition: filter 0.3s ease;
        }

        /* 5️⃣ UI Alive Signal */
        .signal-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #ff1111;
            box-shadow: 0 0 8px rgba(255,0,0,0.6);
            animation: signalBlink 3s infinite;
            margin-left: 8px;
        }
        @keyframes signalBlink {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* --- 3. METAL BEVEL CARDS & FOCUS MODE --- */
        #timerContainer {
            animation: systemBreath 8s ease-in-out infinite;
        }

        .card-elite {
            background: linear-gradient(165deg, #090909 0%, #030303 100%);
            border: 1px solid #111;
            box-shadow: 
                inset 0 1px 0 rgba(255,255,255,0.08), 
                inset 0 -1px 0 rgba(0,0,0,0.8),
                0 10px 40px rgba(0,0,0,0.9);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.4s ease, border-color 0.4s ease, filter 0.4s ease, opacity 0.4s ease;
            will-change: transform;
        }

        /* 4️⃣ Safe Glass Effect */
        @supports (backdrop-filter: blur(1px)) {
            .card-elite {
                backdrop-filter: blur(1px);
            }
        }
        
        /* 7️⃣ Chromatic Aberration */
        .card-elite::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: linear-gradient(
                90deg,
                rgba(255,0,0,0.02),
                transparent,
                rgba(0,200,255,0.02)
            );
            z-index: 2;
        }

        /* 3️⃣ Cinematic Focus Mode Logic */
        #timerContainer:hover .card-elite {
            opacity: 0.55;
            filter: grayscale(0.6) blur(0.5px);
        }
        
        /* Hovering specific card: Restore/Highlight */
        #timerContainer .card-elite:hover {
            opacity: 1;
            filter: grayscale(0) blur(0);
            z-index: 10;
            border-color: #333;
            box-shadow: 
                inset 0 1px 0 rgba(255,255,255,0.15), 
                0 20px 60px rgba(0,0,0,1);
            transform: scale(1.02);
        }
        
        /* Critical Hover */
        #timerContainer .card-elite.critical:hover {
            filter: brightness(1.15) contrast(1.1);
        }
        
        /* Power Focus Letter Spacing */
        .card-elite:hover .timer-display {
            letter-spacing: -2px;
        }

        .card-elite::after {
            content: "";
            position: absolute;
            top: 0; left: -150%;
            width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 17, 17, 0.1), transparent);
            transform: skewX(-25deg);
            transition: left 0.8s ease;
            pointer-events: none;
        }
        .card-elite:hover::after {
            left: 200%;
        }

        .logo-badge {
            filter: grayscale(100%) contrast(140%) brightness(0.6);
            transition: opacity 0.3s ease, filter 0.3s ease;
        }
        .card-elite:hover .logo-badge {
            filter: grayscale(100%) contrast(140%) brightness(0.9);
            opacity: 0.4;
        }

        /* --- 4. TYPOGRAPHY & STATES --- */
        .timer-display {
            transition: color .4s ease, text-shadow .4s ease, opacity 0.4s ease, letter-spacing 0.4s ease;
            will-change: transform;
        }
        
        @keyframes tickJump {
            0% { transform: translateY(-2px); opacity: 0.8; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .timer-display.tick {
            animation: tickJump 0.15s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .text-chrome {
            background: linear-gradient(to bottom, #ffffff 40%, #888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.8));
        }

        .timer-display.standby {
            color: #cfcfcf;
            text-shadow: 0 0 10px rgba(255,255,255,0.1);
            animation: breathe 4s infinite ease-in-out;
        }
        @keyframes breathe {
            0%, 100% { opacity: 0.8; text-shadow: 0 0 5px rgba(255,255,255,0.1); }
            50% { opacity: 1; text-shadow: 0 0 15px rgba(255,255,255,0.3); }
        }

        /* Critical State (<10s) */
        .card-elite.critical {
            filter: brightness(1.15) contrast(1.1);
            border-color: #331111;
        }

        @keyframes lockPulse {
            0%, 100% { box-shadow: inset 0 0 30px rgba(50, 0, 0, 0.3), 0 0 20px rgba(20, 0, 0, 0.5); border-color: #4a0000; }
            50% { box-shadow: inset 0 0 40px rgba(80, 0, 0, 0.4), 0 0 35px rgba(50, 0, 0, 0.7); border-color: #660000; }
        }
        
        /* 2️⃣ Fixed Animation Stack */
        .card-elite.active {
            animation: lockPulse 2.5s infinite;
        }
        .card-elite.active.critical {
            animation: lockPulse 2.5s infinite, shake 0.3s infinite;
        }
        
        .card-elite.active .timer-display {
            color: #ff1111;
            text-shadow: 0 0 15px rgba(255, 17, 17, 0.6);
            font-weight: 800;
            letter-spacing: -1px;
        }

        @keyframes systemBreath {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.01); } 
        }

        /* --- 5. EXECUTE BUTTON --- */
        .btn-execute {
            background: linear-gradient(180deg, #1a0000 0%, #050000 100%);
            border: 1px solid #330000;
            color: #cc0000;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            box-shadow: inset 0 0 20px rgba(255,0,0,0.05), 0 4px 10px rgba(0,0,0,0.5);
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .btn-execute::before {
            content: "";
            position: absolute;
            top: -120%;
            left: 0;
            width: 100%;
            height: 240%;
            background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.15), transparent);
            transform: translateY(-100%);
            transition: transform 0.6s cubic-bezier(0.2, 1, 0.3, 1);
            pointer-events: none;
        }
        .btn-execute:hover::before {
            transform: translateY(100%);
        }
        .btn-execute::after {
            content: "";
            position: absolute;
            inset: 0;
            border: 1px solid rgba(255,17,17,0.25);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .btn-execute:hover:not(:disabled) {
            color: #ff1111;
            border-color: #660000;
            text-shadow: 0 0 8px #ff1111;
            animation: pulseRed 1.6s infinite;
        }
        .btn-execute:hover::after { opacity: 1; }
        @keyframes pulseRed {
            0%, 100% { box-shadow: 0 0 12px rgba(255,0,0,0.15); }
            50% { box-shadow: 0 0 28px rgba(255,0,0,0.35); }
        }
        .btn-execute:active:not(:disabled) { transform: translateY(1px); box-shadow: inset 0 0 30px rgba(0,0,0,0.9); }
        .btn-execute:disabled { background: #050505; border-color: #1a1a1a; color: #333; cursor: not-allowed; box-shadow: none; }

        /* --- 6. ENERGY BAR --- */
        .energy-track { background: #020202; border: 1px solid #1a1a1a; height: 4px; box-shadow: inset 0 1px 3px rgba(0,0,0,1); }
        .energy-bar { height: 100%; position: relative; overflow: hidden; background: linear-gradient(90deg, #330000, #ff1111); box-shadow: 0 0 15px rgba(255, 17, 17, 0.4); transition: width 1s linear; }
        .energy-bar::after { content: ""; position: absolute; top: 0; left: -100%; bottom: 0; width: 50%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); animation: energyFlow 3.5s linear infinite; }
        .energy-bar.standby-core { background: linear-gradient(90deg, #1a1a1a, #555); box-shadow: 0 0 10px rgba(255, 255, 255, 0.1); }
        @keyframes energyFlow { 0% { left: -100%; } 100% { left: 200%; } }

        /* --- 7. BOOT & UTILS --- */
        #boot-overlay { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 1s ease-out; }
        
        .boot-log { font-family: 'Share Tech Mono', monospace; color: #a0a0a0; font-size: 12px; margin-top: 20px; text-align: left; width: 300px; height: 100px; overflow: hidden; }
        /* Boot Cursor */
        .boot-log::after {
            content: "▋";
            animation: blink 1s infinite;
            color: #ff1111;
            display: inline-block;
        }
        @keyframes blink { 50% { opacity: 0; } }
        
        /* Hide cursor when hidden */
        #boot-overlay.hidden .boot-log::after { display: none; }
        #boot-overlay.hidden { pointer-events: none; }

        .log-line { display: block; opacity: 0; animation: fadeIn 0.1s forwards; }
        .log-line.success { color: #ff1111; }
        @keyframes fadeIn { to { opacity: 1; } }
        .boot-btn { border: 1px solid #333; padding: 1rem 3rem; color: #666; font-family: 'Cinzel', serif; font-weight: 700; cursor: pointer; transition: 0.3s; letter-spacing: 2px; background: rgba(10,10,10,0.8); z-index: 110; }
        .boot-btn:hover { border-color: #ff1111; color: #ff1111; box-shadow: 0 0 30px rgba(255, 17, 17, 0.15); }
        @keyframes royalReveal { 0% { opacity: 0; transform: translateY(-20px); } 100% { opacity: 1; transform: translateY(0); } }
        .header-reveal { opacity: 0; }
        .header-reveal.visible { animation: royalReveal 1.5s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
        .input-elite { background: transparent; border: none; border-bottom: 1px solid #222; color: #ddd; font-family: 'Rajdhani', sans-serif; font-weight: 600; letter-spacing: 1px; transition: 0.3s; text-transform: uppercase; }
        .input-elite:focus { outline: none; border-bottom-color: #ff1111; text-shadow: 0 0 8px rgba(255, 17, 17, 0.5); }

        /* 5️⃣ Reduced Motion & Accessibility Fix */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
            .log-line, .header-reveal {
                opacity: 1 !important;
                transform: none !important;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8 flex flex-col items-center min-h-screen relative">

    <!-- Scanlines -->
    <div class="scanlines"></div>
    
    <!-- Watermark -->
    <img src="https://img5.pic.in.th/file/secure-sv1/Logo9c1f24a21fb14b54.png" alt="BackSecret Logo" class="logo-watermark">

    <!-- Boot Overlay -->
    <div id="boot-overlay">
        <div class="mb-8 opacity-60">
            <img src="https://img5.pic.in.th/file/secure-sv1/Logo9c1f24a21fb14b54.png" width="90" class="grayscale contrast-125">
        </div>
        <button onclick="bootSystem()" class="boot-btn" id="boot-btn">
            INITIALIZE PROTOCOL
        </button>
        <div class="boot-log" id="boot-log"></div>
    </div>

    <!-- Header -->
    <header class="w-full max-w-[1500px] flex flex-col md:flex-row justify-between items-center mb-10 z-20 border-b border-white/5 pb-6 header-reveal" id="main-header">
        <div class="flex items-center gap-6 mb-4 md:mb-0 pl-2">
            <img src="https://img5.pic.in.th/file/secure-sv1/Logo9c1f24a21fb14b54.png" alt="Logo" class="w-14 h-14 object-contain">
            
            <div class="flex flex-col">
                <h1 class="text-4xl md:text-5xl font-royal font-bold text-chrome tracking-widest leading-none">
                    BACKSECRET
                </h1>
                <div class="flex items-center gap-3 mt-2">
                    <span class="h-[1px] w-6 bg-red-800"></span>
                    <p class="text-[10px] font-mono tracking-[0.4em] text-red-700 uppercase">ELITE AUTHORITY</p>
                    <div class="signal-dot"></div>
                    <span class="h-[1px] w-6 bg-red-800"></span>
                </div>
            </div>
        </div>

        <!-- Dashboard Stats -->
        <div class="flex gap-8 font-mono text-sm pr-4">
            <div class="flex flex-col items-end">
                <span class="text-[9px] text-gray-600 uppercase tracking-widest">Active Locks</span>
                <span class="text-xl font-bold text-red-600 drop-shadow-[0_0_5px_rgba(255,0,0,0.5)]" id="active-locks-text">0</span>
            </div>
            <div class="w-px bg-white/5 h-8 my-auto"></div>
            <div class="flex flex-col items-end">
                <span class="text-[9px] text-gray-600 uppercase tracking-widest">Next Cycle</span>
                <span class="text-xl font-bold text-gray-400" id="next-ready-display">--:--</span>
            </div>
        </div>
    </header>

    <!-- Controls Bar -->
    <div class="w-full max-w-[1500px] flex justify-between items-end gap-3 mb-6 z-20 opacity-0 transition-opacity duration-1000" id="controls-bar">
        <button onclick="toggleCompactMode()" class="text-[10px] font-mono text-gray-600 hover:text-white transition-colors flex items-center gap-2 tracking-widest">
            <i class="fa-solid fa-layer-group"></i> <span id="view-text">GRID VIEW</span>
        </button>

        <div class="flex gap-2">
            <button onclick="toggleSound()" id="soundBtn" class="w-8 h-8 border border-white/10 flex items-center justify-center text-gray-600 hover:text-red-500 hover:border-red-900 transition bg-black/50 text-xs">
                <i class="fa-solid fa-volume-high"></i>
            </button>
            <button onclick="requestNotificationPermission()" class="h-8 px-3 border border-white/10 flex items-center justify-center text-[10px] text-gray-600 hover:text-white hover:border-gray-500 transition bg-black/50 font-mono tracking-wider">
                NOTIFICATIONS
            </button>
        </div>
    </div>

    <!-- Main Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-5 w-full max-w-[1500px] z-20 pb-20 opacity-0 transition-opacity duration-1000 delay-300" id="timerContainer">
        <!-- Cards Injected Here -->
    </div>

    <!-- Footer -->
    <footer class="fixed bottom-0 w-full bg-black/90 border-t border-white/5 py-2 z-50 backdrop-blur-sm flex justify-center">
         <button onclick="resetAllData()" class="text-[9px] font-mono text-red-900/60 hover:text-red-600 transition-colors uppercase tracking-[0.2em]">
            <i class="fa-solid fa-triangle-exclamation mr-1"></i> System Reset
        </button>
    </footer>

    <!-- Audio -->
    <audio id="clickSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.m4a"></audio>
    <audio id="warnSound" src="https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.m4a"></audio>
    <audio id="alarmSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.m4a"></audio>
    <!-- 4️⃣ Ambient Hum -->
    <audio id="ambientHum" loop src="https://assets.mixkit.co/active_storage/sfx/2515/2515-preview.m4a"></audio>

    <script>
        // --- CONFIG ---
        const TOTAL_STORES = 5;
        const DEFAULT_COOLDOWN_MINUTES = 20;
        const STORE_KEY_PREFIX = 'backsecret_authority_';
        
        let stores = [];
        let soundEnabled = true;
        let isCompact = false;
        let lastSecondTick = -1;

        // --- 1️⃣ NO PARALLAX CODE HERE ---

        // --- BOOT SEQUENCE ---
        function bootSystem() {
            const btn = document.getElementById('boot-btn');
            const log = document.getElementById('boot-log');
            btn.style.display = 'none';
            
            const messages = [
                "> CONNECTING TO MONARCH SERVER...",
                "> KEY_HASH: 9c1f24a21fb14b54 VERIFIED",
                "> BACKSECRET AUTHORITY GRANTED",
                "> AWAKENING ELITE PROTOCOLS...",
                "> SYSTEM ONLINE."
            ];

            let delay = 0;
            messages.forEach((msg, i) => {
                setTimeout(() => {
                    const div = document.createElement('div');
                    div.className = 'log-line';
                    if(i === messages.length - 1) div.className += ' success';
                    div.innerText = msg;
                    log.appendChild(div);
                    log.scrollTop = log.scrollHeight;
                    playClick(0.05);
                }, delay);
                delay += 400 + Math.random() * 300;
            });

            setTimeout(() => {
                const overlay = document.getElementById('boot-overlay');
                overlay.classList.add('hidden'); 
                
                // 3️⃣ Realistic Engine Ignition Flash (1.25)
                document.body.style.filter = "brightness(1.25)";
                setTimeout(() => { document.body.style.filter = "none"; }, 150);

                // 4️⃣ Play Ambient Hum
                if(soundEnabled) {
                    const hum = document.getElementById('ambientHum');
                    hum.volume = 0.08;
                    hum.play().catch(()=>{});
                }

                setTimeout(() => {
                    overlay.style.display = 'none';
                    revealInterface();
                }, 1000);
            }, delay + 800);
        }

        function revealInterface() {
            document.getElementById('main-header').classList.add('visible');
            document.getElementById('controls-bar').style.opacity = '1';
            document.getElementById('timerContainer').style.opacity = '1';
            
            loadStoreData();
            if(localStorage.getItem('backsecret_compact') === 'true') {
                isCompact = true;
                updateViewBtn();
            }
            renderTimers();
            requestAnimationFrame(loop);
            updateSoundIcon();
        }

        function loadStoreData() {
            stores = [];
            for (let i = 0; i < TOTAL_STORES; i++) {
                const saved = localStorage.getItem(STORE_KEY_PREFIX + i);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if(parsed.warned === undefined) parsed.warned = false;
                    if(parsed.cooldown === undefined) parsed.cooldown = DEFAULT_COOLDOWN_MINUTES;
                    stores.push(parsed);
                } else {
                    stores.push({
                        id: i,
                        name: `TARGET 0${i + 1}`,
                        cooldown: DEFAULT_COOLDOWN_MINUTES,
                        endTime: null,
                        status: 'ready',
                        warned: false
                    });
                }
            }
        }

        function saveStoreData(index) {
            localStorage.setItem(STORE_KEY_PREFIX + index, JSON.stringify(stores[index]));
        }

        function renderTimers() {
            const container = document.getElementById('timerContainer');
            // OPTIMIZED RENDERING: Build string once
            let htmlBuffer = '';
            
            container.className = isCompact 
                ? 'grid grid-cols-2 md:grid-cols-4 xl:grid-cols-6 gap-3 w-full max-w-[1500px] z-20 pb-20'
                : 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-5 w-full max-w-[1500px] z-20 pb-20';

            stores.forEach((store, index) => {
                htmlBuffer += `
                    <div class="card-elite rounded p-5 flex flex-col group h-full justify-between relative" id="card-${index}">
                        
                        <div class="absolute top-3 right-3 opacity-20">
                            <img src="https://img5.pic.in.th/file/secure-sv1/Logo9c1f24a21fb14b54.png" class="logo-badge w-6 h-6">
                        </div>

                        <div class="flex justify-between items-start mb-2 opacity-60 group-hover:opacity-100 transition-opacity">
                            <div class="w-full mr-6">
                                <label class="text-[8px] text-gray-500 font-mono tracking-widest uppercase block mb-1">UNIT_ID_0${index+1}</label>
                                <input type="text" value="${store.name}" 
                                    onchange="updateName(${index}, this.value)"
                                    class="input-elite w-full text-sm"
                                    placeholder="SET NAME"
                                >
                            </div>
                            <button onclick="setCustomTime(${index})" class="text-gray-700 hover:text-white transition-colors text-[10px] pt-3">
                                <i class="fa-solid fa-gear"></i>
                            </button>
                        </div>

                        <div class="flex flex-col items-center justify-center py-4 my-2 relative">
                            <div class="font-tech text-5xl font-bold tracking-tighter text-chrome timer-display transition-colors" id="timer-display-${index}">
                                00:00
                            </div>
                            <div class="mt-2" id="status-container-${index}">
                                <span class="text-[9px] font-mono tracking-[0.3em] text-gray-500 uppercase">STANDBY</span>
                            </div>
                        </div>

                        <div class="energy-track w-full mb-5">
                            <div id="progress-${index}" class="energy-bar standby-core" style="width: 100%"></div>
                        </div>

                        <div class="grid grid-cols-4 gap-1 mt-auto">
                            <button onclick="startTimer(${index})" id="btn-start-${index}"
                                class="col-span-4 btn-execute py-3 text-sm flex items-center justify-center gap-2 group-hover:tracking-widest transition-all">
                                EXECUTE
                            </button>
                            <button onclick="adjustTime(${index}, -1)" class="col-span-1 bg-[#0a0a0a] border border-[#1a1a1a] text-gray-600 hover:text-white hover:border-gray-600 text-[9px] py-1 font-mono transition-colors">
                                -1M
                            </button>
                            <button onclick="resetTimer(${index})" class="col-span-3 bg-[#0a0a0a] border border-[#1a1a1a] text-gray-500 hover:text-red-500 hover:border-red-900 text-[9px] py-1 font-mono uppercase tracking-wider transition-colors">
                                <i class="fa-solid fa-rotate-left mr-1"></i> RESET
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = htmlBuffer;
            updateTimers(true); 
        }

        function loop() {
            updateTimers(false);
            requestAnimationFrame(loop);
        }

        function updateTimers(forceUpdate = false) {
            const now = Date.now();
            const currentSecond = Math.floor(now / 1000);
            const isNewSecond = (currentSecond !== lastSecondTick) || forceUpdate;
            if(isNewSecond) lastSecondTick = currentSecond;

            let activeLocksCount = 0;
            let nearestTime = Infinity;

            stores.forEach((store, index) => {
                const card = document.getElementById(`card-${index}`);
                const display = document.getElementById(`timer-display-${index}`);
                const statusContainer = document.getElementById(`status-container-${index}`);
                const progress = document.getElementById(`progress-${index}`);
                const btnStart = document.getElementById(`btn-start-${index}`);
                if (!card) return;

                if (store.status === 'cooldown' && store.endTime) {
                    const distance = store.endTime - now;
                    activeLocksCount++;
                    if (distance > 0 && store.endTime < nearestTime) nearestTime = store.endTime;

                    if (distance < 0) {
                        finishCooldown(index);
                    } else {
                        if (isNewSecond) {
                            const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                            const s = Math.floor((distance % (1000 * 60)) / 1000);
                            display.innerText = `${pad(m)}:${pad(s)}`;
                            
                            // 3️⃣ Mechanical Tick Jump Effect
                            display.classList.remove('tick');
                            void display.offsetWidth; // Reflow
                            display.classList.add('tick');

                            if (!card.classList.contains('active')) {
                                display.classList.remove('standby');
                                statusContainer.innerHTML = `
                                    <span class="text-[10px] font-mono tracking-[0.25em] text-red-600 uppercase text-shadow-glow animate-pulse">LOCKED</span>
                                `;
                                card.classList.add('active');
                                btnStart.disabled = true;
                                btnStart.innerHTML = `SYSTEM LOCKED`;
                            }
                        }

                        // Critical Awakening (<10s)
                        if (distance < 10000) {
                            card.classList.add('critical');
                        } else {
                            card.classList.remove('critical');
                        }

                        const total = store.cooldown * 60 * 1000;
                        const pct = Math.max(0, Math.min(100, (distance / total) * 100));
                        progress.style.width = `${pct}%`;
                        progress.classList.remove('standby-core');

                        if (distance < 60000 && !store.warned) {
                            playWarn();
                            store.warned = true;
                            // 2️⃣ Localized shake using Class
                            card.classList.add('card-hit');
                            setTimeout(() => card.classList.remove('card-hit'), 200);
                            
                            saveStoreData(index);
                        }
                    }
                } else {
                    if(isNewSecond) {
                        if (display.innerText !== "STANDBY") {
                            display.innerText = "STANDBY";
                            display.classList.add('standby');
                            statusContainer.innerHTML = `<span class="text-[9px] font-mono tracking-[0.3em] text-gray-500 uppercase">AWAITING INPUT</span>`;
                            card.classList.remove('active');
                            card.classList.remove('critical');
                            btnStart.disabled = false;
                            btnStart.innerHTML = `EXECUTE (${store.cooldown}M)`;
                            progress.style.width = '100%';
                            progress.classList.add('standby-core');
                        }
                    }
                }
            });

            if(isNewSecond) {
                document.getElementById('active-locks-text').innerText = `${activeLocksCount}`;
                document.getElementById('next-ready-display').innerText = nearestTime !== Infinity ? getTimeStr(nearestTime) : "--:--";
                const soundBtn = document.getElementById('soundBtn');
                if(activeLocksCount > 0 && soundEnabled) soundBtn.classList.add("animate-pulse");
                else soundBtn.classList.remove("animate-pulse");

                // 1️⃣ Smart Ticking: Play ONCE per second if ANY lock is active
                if(activeLocksCount > 0 && soundEnabled) {
                    const click = document.getElementById('clickSound');
                    click.volume = 0.03; 
                    click.currentTime = 0;
                    click.play().catch(()=>{});
                }
            }
        }

        function startTimer(index) {
            playClick(0.3);
            const now = Date.now();
            stores[index].status = 'cooldown';
            stores[index].endTime = now + (stores[index].cooldown * 60 * 1000);
            stores[index].warned = false;
            saveStoreData(index);
            updateTimers(true);
        }

        function resetTimer(index) {
            playClick(0.3);
            stores[index].status = 'ready';
            stores[index].endTime = null;
            saveStoreData(index);
            updateTimers(true);
        }

        function adjustTime(index, min) {
            if(stores[index].status !== 'cooldown') return;
            playClick(0.2);
            stores[index].endTime += (min * 60 * 1000);
            saveStoreData(index);
            updateTimers(true);
        }
        
        function setCustomTime(index) {
            const current = stores[index].cooldown || DEFAULT_COOLDOWN_MINUTES;
            const m = prompt(`Set Cooldown (Minutes):`, current);
            if(m && !isNaN(m)) {
                playClick(0.2);
                stores[index].cooldown = parseFloat(m);
                saveStoreData(index);
                renderTimers();
            }
        }

        function toggleCompactMode() {
            isCompact = !isCompact;
            updateViewBtn();
            localStorage.setItem('backsecret_compact', isCompact);
            renderTimers();
            playClick(0.2);
        }

        function updateViewBtn() { document.getElementById('view-text').innerText = isCompact ? "NORMAL VIEW" : "GRID VIEW"; }
        function updateName(index, val) { stores[index].name = val; saveStoreData(index); }

        function finishCooldown(index) {
            stores[index].status = 'ready';
            stores[index].endTime = null;
            saveStoreData(index);
            if(soundEnabled) document.getElementById('alarmSound').play().catch(()=>{});
            if(Notification.permission === "granted") new Notification("TARGET UNLOCKED", { body: `${stores[index].name} is Primed.` });
            updateTimers(true);
        }

        function resetAllData() {
            if(confirm("CONFIRM: WIPE SYSTEM DATA?")) {
                playWarn();
                localStorage.clear();
                location.reload();
            }
        }

        function pad(n) { return n < 10 ? '0' + n : n; }
        function getTimeStr(timestamp) { const d = new Date(timestamp); return `${pad(d.getHours())}:${pad(d.getMinutes())}`; }
        function playClick(vol = 0.2) { if(soundEnabled) { const s = document.getElementById('clickSound'); s.volume = vol; s.currentTime = 0; s.play().catch(()=>{}); } }
        function playWarn() { if(soundEnabled) { const s = document.getElementById('warnSound'); s.volume = 0.4; s.currentTime=0; s.play().catch(()=>{}); } }
        
        function toggleSound() { 
            soundEnabled = !soundEnabled; 
            updateSoundIcon(); 
            
            const hum = document.getElementById('ambientHum');
            if(soundEnabled) {
                playClick(0.2);
                if(document.getElementById('boot-overlay').style.display === 'none') {
                    hum.volume = 0.08;
                    hum.play().catch(()=>{});
                }
            } else {
                hum.pause();
            }
        }

        function updateSoundIcon() {
            const btn = document.getElementById('soundBtn');
            btn.innerHTML = soundEnabled ? '<i class="fa-solid fa-volume-high text-red-500"></i>' : '<i class="fa-solid fa-volume-xmark text-gray-600"></i>';
            btn.style.borderColor = soundEnabled ? '#4a0000' : 'rgba(255,255,255,0.1)';
        }

        function requestNotificationPermission() {
            if(!("Notification" in window)) return;
            Notification.requestPermission().then(p => { if(p === "granted") { new Notification("SYSTEM LINKED"); playClick(0.2); } });
        }
    </script>
</body>
</html>